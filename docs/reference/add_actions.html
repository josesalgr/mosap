<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add actions to a planning problem — add_actions • mosap</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add actions to a planning problem — add_actions"><meta name="description" content="Define the set of management actions, where they can be implemented (feasibility),
their costs, and optional lock status per (pu, action) pair. The function stores
the action catalogue in x$data$actions and the feasible action distribution in
x$data$dist_actions.
Feasibility is controlled via include / exclude:
If include is NULL and feasible_default = TRUE, all
(pu, action) pairs are feasible.
If include is provided, only those (pu, action) pairs are feasible.
If exclude is provided, those (pu, action) pairs are removed from the
feasible set (either the full set or include).

"><meta property="og:description" content="Define the set of management actions, where they can be implemented (feasibility),
their costs, and optional lock status per (pu, action) pair. The function stores
the action catalogue in x$data$actions and the feasible action distribution in
x$data$dist_actions.
Feasibility is controlled via include / exclude:
If include is NULL and feasible_default = TRUE, all
(pu, action) pairs are feasible.
If include is provided, only those (pu, action) pairs are feasible.
If exclude is provided, those (pu, action) pairs are removed from the
feasible set (either the full set or include).

"><meta property="og:image" content="https://josesalgr.github.io/mosap/logo.png"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6YB8F3838H"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6YB8F3838H');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mosap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/josesalgr/mosap"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add actions to a planning problem</h1>
      <small class="dont-index">Source: <a href="https://github.com/josesalgr/mosap/blob/HEAD/R/add_actions.R" class="external-link"><code>R/add_actions.R</code></a></small>
      <div class="d-none name"><code>add_actions.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Define the set of management actions, where they can be implemented (feasibility),
their costs, and optional lock status per <code>(pu, action)</code> pair. The function stores
the action catalogue in <code>x$data$actions</code> and the feasible action distribution in
<code>x$data$dist_actions</code>.</p>
<p>Feasibility is controlled via <code>include</code> / <code>exclude</code>:</p><ul><li><p>If <code>include</code> is <code>NULL</code> and <code>feasible_default = TRUE</code>, all
<code>(pu, action)</code> pairs are feasible.</p></li>
<li><p>If <code>include</code> is provided, only those <code>(pu, action)</code> pairs are feasible.</p></li>
<li><p>If <code>exclude</code> is provided, those <code>(pu, action)</code> pairs are removed from the
feasible set (either the full set or <code>include</code>).</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_actions</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">actions</span>,</span>
<span>  include <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  exclude <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cost <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  status <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  feasible_default <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  na_is_infeasible <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sort_actions <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>Data</code> object created with <code><a href="inputData.html">inputData</a></code> or <code><a href="inputDataSpatial.html">inputDataSpatial</a></code>.
Must contain at least <code>x$data$pu</code>, <code>x$data$features</code>, and <code>x$data$dist_features</code>.</p></dd>


<dt id="arg-actions">actions<a class="anchor" aria-label="anchor" href="#arg-actions"></a></dt>
<dd><p>A <code>data.frame</code> defining the action catalogue. Must contain a unique
<code>id</code> column (action identifiers). For backwards compatibility, a column named
<code>action</code> is also accepted and will be renamed to <code>id</code>. Additional columns are kept.</p></dd>


<dt id="arg-include">include<a class="anchor" aria-label="anchor" href="#arg-include"></a></dt>
<dd><p>Optional feasibility specification. If provided, only these <code>(pu, action)</code>
pairs are feasible. Accepts <code>NULL</code>, a <code>data.frame</code>, or a named list (see Details).</p></dd>


<dt id="arg-exclude">exclude<a class="anchor" aria-label="anchor" href="#arg-exclude"></a></dt>
<dd><p>Optional infeasibility specification. Removed from the feasible set defined by
<code>include</code> (or from the full set if <code>include</code> is <code>NULL</code> and
<code>feasible_default = TRUE</code>). Accepts the same formats as <code>include</code>.</p></dd>


<dt id="arg-cost">cost<a class="anchor" aria-label="anchor" href="#arg-cost"></a></dt>
<dd><p>Optional cost specification for feasible <code>(pu, action)</code> pairs. Accepts:</p><ul><li><p><code>NULL</code>: default cost = 1 for all pairs,</p></li>
<li><p>a single numeric scalar,</p></li>
<li><p>a named numeric vector (names = action ids),</p></li>
<li><p>a <code>data.frame(action, cost)</code> or <code>data.frame(pu, action, cost)</code>.</p></li>
</ul></dd>


<dt id="arg-status">status<a class="anchor" aria-label="anchor" href="#arg-status"></a></dt>
<dd><p>Optional <code>data.frame</code> with columns <code>pu</code>, <code>action</code>, and <code>status</code>
specifying lock status for feasible pairs. Status must be in <code>{0, 2, 3}</code>.</p></dd>


<dt id="arg-feasible-default">feasible_default<a class="anchor" aria-label="anchor" href="#arg-feasible-default"></a></dt>
<dd><p>Logical. If <code>include</code> is <code>NULL</code>, should all actions be feasible
in all planning units? If <code>FALSE</code> and <code>include</code> is <code>NULL</code>, the function errors.</p></dd>


<dt id="arg-na-is-infeasible">na_is_infeasible<a class="anchor" aria-label="anchor" href="#arg-na-is-infeasible"></a></dt>
<dd><p>Logical. Only relevant when <code>include</code>/<code>exclude</code> are provided as
<code>data.frame</code>s with a <code>feasible</code> column. If <code>TRUE</code>, treat <code>NA</code> as <code>FALSE</code>.</p></dd>


<dt id="arg-sort-actions">sort_actions<a class="anchor" aria-label="anchor" href="#arg-sort-actions"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, sort <code>actions</code> by <code>id</code> before assigning
internal ids.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The updated <code>Data</code> object with:</p><ul><li><p><code>x$data$actions</code>: action catalogue including <code>internal_id</code>,</p></li>
<li><p><code>x$data$dist_actions</code>: feasible <code>(pu, action)</code> pairs with columns
<code>pu</code>, <code>action</code>, <code>cost</code>, <code>status</code>, <code>internal_pu</code>, and <code>internal_action</code>,</p></li>
<li><p><code>x$data$index$pu</code> and <code>x$data$index$action</code>: id-to-internal-id mappings.</p></li>
</ul><p>The updated <a href="data-class.html">data</a> object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Accepted formats for <code>include</code> and <code>exclude</code>:</strong></p><ul><li><p><code>NULL</code>: no restriction (only valid for <code>include</code> when
<code>feasible_default = TRUE</code>).</p></li>
<li><p>A <code>data.frame</code> with columns <code>pu</code> and <code>action</code>. An optional
<code>feasible</code> column is supported as a filter (only rows with <code>feasible == TRUE</code>
are used). If <code>na_is_infeasible = TRUE</code>, <code>NA</code> values in <code>feasible</code> are treated
as <code>FALSE</code>. Action ids must match <code>actions$id</code>, and PU ids must match
<code>x$data$pu$id</code>.</p></li>
<li><p>A named list with names equal to action ids. Each element can be:</p><ul><li><p>an integer vector of PU ids, or</p></li>
<li><p>an <code>sf</code> object defining a spatial zone for that action.</p></li>
</ul></li>
</ul><p><strong>Spatial feasibility:</strong> when <code>include</code>/<code>exclude</code> are provided as <code>sf</code> layers,
feasibility is computed using spatial predicates (no geometries are cut). Specifically,
planning units in <code>x$data$pu_sf</code> are matched to zones via <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">sf::st_intersects()</a></code>.
This procedure does not create new planning unit geometries.</p>
<p><strong>Costs:</strong> costs can be specified as a single scalar applied to all feasible pairs,
a named numeric vector by action id, or a <code>data.frame</code> providing costs by action
(<code>action, cost</code>) or by pair (<code>pu, action, cost</code>). Costs must be finite and non-negative.</p>
<p><strong>Locks:</strong> <code>status</code> can set the lock status for specific feasible pairs.
Status must be one of <code>0</code> (free), <code>2</code> (locked-in), or <code>3</code> (locked-out).
If <code>x$data$pu</code> contains a logical <code>locked_out</code> column, then all action pairs in those
PUs are forced to <code>status = 3</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="inputData.html">inputData</a></code>, <code><a href="inputDataSpatial.html">inputDataSpatial</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Action catalogue</span></span></span>
<span class="r-in"><span><span class="va">actions_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"harvest"</span>, <span class="st">"sustainable"</span>, <span class="st">"restoration"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 1) Full feasibility (all actions everywhere), constant cost</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">add_actions</span><span class="op">(</span><span class="va">p</span>, actions <span class="op">=</span> <span class="va">actions_df</span>, cost <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2) Only allow some pairs (include)</span></span></span>
<span class="r-in"><span><span class="va">include_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  pu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"harvest"</span>, <span class="st">"harvest"</span>, <span class="st">"restoration"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">add_actions</span><span class="op">(</span><span class="va">p</span>, actions <span class="op">=</span> <span class="va">actions_df</span>, include <span class="op">=</span> <span class="va">include_df</span>, cost <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3) Allow everything except some impossible pairs (exclude)</span></span></span>
<span class="r-in"><span><span class="va">exclude_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"harvest"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">add_actions</span><span class="op">(</span><span class="va">p</span>, actions <span class="op">=</span> <span class="va">actions_df</span>, exclude <span class="op">=</span> <span class="va">exclude_df</span>, cost <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 4) Feasibility as a named list (PU ids per action)</span></span></span>
<span class="r-in"><span><span class="va">include_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  harvest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  restoration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">add_actions</span><span class="op">(</span><span class="va">p</span>, actions <span class="op">=</span> <span class="va">actions_df</span>, include <span class="op">=</span> <span class="va">include_list</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 5) Action-specific costs (named vector)</span></span></span>
<span class="r-in"><span><span class="va">costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>harvest <span class="op">=</span> <span class="fl">5</span>, sustainable <span class="op">=</span> <span class="fl">2</span>, restoration <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">add_actions</span><span class="op">(</span><span class="va">p</span>, actions <span class="op">=</span> <span class="va">actions_df</span>, cost <span class="op">=</span> <span class="va">costs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 6) Lock status for specific pairs</span></span></span>
<span class="r-in"><span><span class="va">st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"harvest"</span>, <span class="st">"restoration"</span><span class="op">)</span>, status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">2L</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">add_actions</span><span class="op">(</span><span class="va">p</span>, actions <span class="op">=</span> <span class="va">actions_df</span>, status <span class="op">=</span> <span class="va">st</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://scholar.google.com/citations?user=Z3F-9DgAAAAJ&amp;hl=en" class="external-link">Jose Salgado-Rojas</a>, <a href="https://www.ctfc.cat/personal24_det.php?id=148" class="external-link">Matias Moreno-Faguett</a>, <a href="https://scholar.google.com/citations?user=OLJaCsYAAAAJ&amp;hl=en" class="external-link">Nuria Aquilue</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

