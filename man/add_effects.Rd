% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/add_effects.R
\name{add_effects}
\alias{add_effects}
\title{Add effects (benefit/loss) to a planning problem}
\usage{
add_effects(
  x,
  effects = NULL,
  effect_type = c("delta", "after"),
  effect_aggregation = c("sum", "mean"),
  align_rasters = TRUE,
  keep_zero = FALSE,
  drop_locked_out = TRUE,
  na_to_zero = TRUE,
  filter = c("any", "benefit", "loss")
)
}
\arguments{
\item{x}{A \linkS4class{data} object created with \code{\link[=inputData]{inputData()}} or \code{\link[=inputDataSpatial]{inputDataSpatial()}}.}

\item{effects}{Specification of effects. One of:
\itemize{
\item NULL: store an empty table (recommended default; no info).
\item A data.frame(action, feature, multiplier):
signed \code{delta = amount * multiplier} (multiplier can be negative).
feature can be numeric ids OR character feature names (matching \code{x$data$features$name}).
\item A data.frame(pu, action, feature, ...):
with either:
\itemize{
\item \code{delta} (signed), or alias \code{effect} (signed), or legacy \code{benefit} (signed), or
\item \code{after} (after-action amount; use \code{effect_type="after"}), or
\item already split columns \code{benefit} and/or \code{loss} (both non-negative).
}
\item A named list of terra::SpatRaster objects:
names = action ids; each raster has one layer per feature. Values are aggregated by PU.
If \code{effect_type="after"}, raster values are treated as after-action amounts and
converted to deltas; otherwise treated as signed deltas.
}}

\item{effect_type}{character. Interpretation of provided values when \code{effects} is an
explicit table or a list of rasters:
\itemize{
\item "delta" (default): values represent signed deltas.
\item "after": values represent after-action amounts (converted to deltas).
}}

\item{effect_aggregation}{Aggregation used to compute PU-level values from rasters
(default: "sum").}

\item{align_rasters}{Logical. If TRUE, attempt to align effect rasters to the PU raster
grid before zonal operations (default TRUE).}

\item{keep_zero}{Logical. Keep rows with \code{benefit==0 AND loss==0}? Default FALSE (drops them).}

\item{drop_locked_out}{Logical. If TRUE, drop rows for (pu, action) with status == 3 in dist_actions.}

\item{na_to_zero}{Logical. If TRUE, treat missing values as 0.}

\item{filter}{Character. Filter rows by non-zero component:
\itemize{
\item "any": keep all rows (default)
\item "benefit": keep only rows with \code{benefit > 0}
\item "loss": keep only rows with \code{loss > 0}
}}
}
\value{
The updated \linkS4class{data} object.
}
\description{
Create an effects table (\code{dist_effects}) describing the marginal change caused by
each feasible (pu, action) pair on each feature, split into two \strong{non-negative}
components:
\itemize{
\item \code{benefit} \eqn{\ge 0}: positive delta (improvement)
\item \code{loss} \eqn{\ge 0}: negative delta magnitude (damage), i.e. \code{loss = -min(delta,0)}
}

Internally, the model can still work with signed effects (e.g., net effect = benefit - loss),
but \code{dist_effects} stores only non-negative columns to avoid ambiguity.

If you provide "after-action" amounts, they are converted to signed deltas:
\deqn{delta = after - baseline}
where baseline is \code{x$data$dist_features$amount} (missing baseline treated as 0).
Then the delta is split into \code{benefit/loss}.

The function supports:
\enumerate{
\item Tabular specifications (NULL / multipliers / explicit table), and
\item Spatial rasters per action (recommended for spatial workflows).
}

It produces \code{x$data$dist_effects} with columns:
\code{pu, action, feature, benefit, loss, internal_pu, internal_action, internal_feature}.
}
